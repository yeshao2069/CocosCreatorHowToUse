{"version":3,"sources":["file:///Users/mu/work/gitee/cocos-creator-how-to-use/proj/Performance/Creator3.5.0_3D_GpuInstancing/assets/script/fight/instacingMaterial.ts"],"names":["_decorator","Component","Material","SkinningModelComponent","ModelComponent","ccclass","property","instacingMaterial","_isEnable","enableInstancing","value","material","instancingMaterial","normalMaterial","skinModel","node","getComponent","len","materials","length","idx","setMaterial","model","start"],"mappings":";;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,sB,OAAAA,sB;AAAwBC,MAAAA,c,OAAAA,c;;;;;;;OAClE;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;mCAGjBO,iB,WADZF,OAAO,CAAC,mBAAD,C,UAQHC,QAAQ,CAACJ,QAAD,C,UAGRI,QAAQ,CAACJ,QAAD,C,2BAXb,MACaK,iBADb,SACuCN,SADvC,CACiD;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAa7CO,SAb6C,GAajC,KAbiC;AAAA;;AAczB,YAAhBC,gBAAgB,CAAEC,KAAF,EAAkB;AAClC,eAAKF,SAAL,GAAiBE,KAAjB;AAEA,cAAIC,QAAQ,GAAG,KAAKH,SAAL,GAAiB,KAAKI,kBAAtB,GAA2C,KAAKC,cAA/D;AACA,cAAIC,SAAS,GAAG,KAAKC,IAAL,CAAUC,YAAV,CAAuBb,sBAAvB,CAAhB;;AAEA,cAAIW,SAAJ,EAAe;AACX,gBAAIG,GAAG,GAAGH,SAAS,CAACI,SAAV,CAAoBC,MAA9B;;AACA,iBAAK,IAAIC,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGH,GAAxB,EAA6BG,GAAG,EAAhC,EAAoC;AAChCN,cAAAA,SAAS,CAACO,WAAV,CAAsBV,QAAtB,EAAgCS,GAAhC;AACH;AACJ,WALD,MAKO;AACH,gBAAIE,KAAK,GAAG,KAAKP,IAAL,CAAUC,YAAV,CAAuBZ,cAAvB,CAAZ;;AACA,gBAAIkB,KAAJ,EAAW;AACP,kBAAIL,IAAG,GAAGK,KAAK,CAACJ,SAAN,CAAgBC,MAA1B;;AACA,mBAAK,IAAIC,IAAG,GAAG,CAAf,EAAkBA,IAAG,GAAGH,IAAxB,EAA6BG,IAAG,EAAhC,EAAoC;AAChCE,gBAAAA,KAAK,CAACD,WAAN,CAAkBV,QAAlB,EAA4BS,IAA5B;AACH;AACJ;AACJ;AAKJ;;AAEmB,YAAhBX,gBAAgB,GAAI;AACpB,iBAAO,KAAKD,SAAZ;AACH;;AAEDe,QAAAA,KAAK,GAAI,CACL;AACH,SA9C4C,CAgD7C;AACA;AACA;;;AAlD6C,O;;;;;iBAQlB,I;;;;;;;iBAGI,I","sourcesContent":["import { _decorator, Component, Node, Material, SkinningModelComponent, ModelComponent } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('instacingMaterial')\nexport class instacingMaterial extends Component {\n    /* class member could be defined like this */\n    // dummy = '';\n\n    /* use `property` decorator if your want the member to be serializable */\n    // @property\n    // serializableDummy = 0;\n    @property(Material)\n    normalMaterial: Material = null;\n\n    @property(Material)\n    instancingMaterial: Material = null;\n\n    _isEnable = false;\n    set enableInstancing (value: boolean) {\n        this._isEnable = value;\n\n        let material = this._isEnable ? this.instancingMaterial : this.normalMaterial;\n        let skinModel = this.node.getComponent(SkinningModelComponent);\n        \n        if (skinModel) {\n            let len = skinModel.materials.length;\n            for (let idx = 0; idx < len; idx++) {\n                skinModel.setMaterial(material, idx);\n            }    \n        } else {\n            let model = this.node.getComponent(ModelComponent);\n            if (model) {\n                let len = model.materials.length;\n                for (let idx = 0; idx < len; idx++) {\n                    model.setMaterial(material, idx);\n                }\n            }\n        }\n\n        \n        \n            \n    }\n\n    get enableInstancing () {\n        return this._isEnable;\n    }\n\n    start () {\n        // Your initialization goes here.\n    }\n\n    // update (deltaTime: number) {\n    //     // Your update function goes here.\n    // }\n}\n"]}