{"version":3,"sources":["file:///Users/mu/work/gitee/cocos-creator-how-to-use/proj/Performance/Creator3.5.0_3D_GpuInstancing/assets/script/ui/main/mainUI.ts"],"names":["_decorator","Component","Node","profiler","Label","SpriteFrame","Sprite","EditBox","playerManager","confirmBox","constants","ccclass","property","mainUI","count","curClickLogoTimes","maxClickLogoTimes","enableInstancing","value","manager","spInstacing","spriteFrame","imgOn","imgOff","enableShadow","spShadow","shareGame","title","imageUrl","window","wx","showShareMenu","withShareTicket","complete","onShareAppMessage","updateManager","getUpdateManager","onUpdateReady","showModal","content","success","res","confirm","applyUpdate","start","cocosAnalytics","init","appID","version","VERSION","storeID","engine","_stats","console","log","showStats","lbVersion","string","updateSwitch","onPeopleNumChanged","onPeopleNumberChanged","bind","spAliasing","enableAntiAliasing","onBtnAddClick","addPlayerGroup","onBtnResetClick","resetPlayer","onBtnReduceClick","reducePlayer","onLogoClick","addDancer","switchInstancing","switchAliasing","str","nodeConfirmBox","getComponent","show","active","switchShadow","onNumberInputEnd","num","Number","parseInt","numberInput","updatePlayerNumber","onNumberClick","evt","data","toString","update","deltaTime","lbFps","Math","round","fps","counter","lbDrawcall","draws","lbInstancing","instances","lbTriangle","tricount","lbGFXMem","textureMemory","toFixed","lbGameLogic","logic","lbArtTriangle","artTriangle","lbVertex","artVertex","lbPeople","people","onDestroy","_rootNode"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, profiler, Label, SpriteFrame, Sprite, EditBox, EventTouch } from 'cc';\nimport { playerManager } from '../../fight/playerManager';\nimport { confirmBox } from './confirmBox';\nimport { constants } from '../../framework/util/constants';\nconst { ccclass, property } = _decorator;\n\n@ccclass('mainUI')\nexport class mainUI extends Component {\n    @property (playerManager)\n    manager: playerManager = null!; \n\n    @property (Label)\n    lbFps: Label = null!;\n\n    @property (Label)\n    lbDrawcall: Label = null!;\n\n    @property (Label)\n    lbInstancing: Label = null!;\n\n    @property (Label)\n    lbTriangle: Label = null!;\n\n    @property (Label)\n    lbGFXMem: Label = null!;\n\n    @property (Label)\n    lbGameLogic: Label = null!;\n\n    @property (Label)\n    lbArtTriangle: Label = null!;\n\n    @property (Label)\n    lbVertex: Label = null!;\n\n    @property (Label)\n    lbPeople: Label = null!;\n\n    @property (SpriteFrame)\n    imgOn: SpriteFrame = null!;\n\n    @property(SpriteFrame)\n    imgOff: SpriteFrame = null!;\n\n    @property(Sprite)\n    spInstacing: Sprite = null!;\n\n    @property(Sprite)\n    spShadow: Sprite = null!;\n\n    @property(Sprite)\n    spAliasing: Sprite = null!;\n\n    @property(Node)\n    nodeConfirmBox: Node = null!;\n\n    @property(Label)\n    lbVersion: Label = null!;\n    \n    @property(EditBox)\n    numberInput: EditBox = null!;\n\n    count: number = 0;\n    curClickLogoTimes: number = 0;\n    maxClickLogoTimes: number = 3;\n\n    set enableInstancing (value: boolean) {\n        this.manager.enableInstancing = value;\n\n        this.spInstacing.spriteFrame = value ? this.imgOn : this.imgOff;\n    }\n\n    get enableInstancing () {\n        return this.manager.enableInstancing;\n    }\n\n    set enableShadow (value: boolean) {\n        this.manager.enableShadow = value;\n\n        this.spShadow.spriteFrame = value ? this.imgOn : this.imgOff;\n    }\n\n    get enableShadow () {\n        return this.manager.enableShadow;\n    }\n\n    shareGame (title: string, imageUrl: string) {\n        // @ts-ignore\n        if (!window.wx) {\n            return;\n        }\n\n        // @ts-ignore\n        window.wx.showShareMenu({\n            withShareTicket: true,\n            complete: ()=>{\n\n            }\n        });\n\n        // @ts-ignore\n        window.wx.onShareAppMessage(function () {\n            // 用户点击了“转发”按钮\n            return {\n                title: title,\n                imageUrl: imageUrl,\n                \n            };\n        });\n        \n        // @ts-ignore\n        var updateManager = window['wx'].getUpdateManager();\n        updateManager.onUpdateReady(()=>{\n            // @ts-ignore\n            window['wx'].showModal({\n                title: '温馨提示',\n                content: '新的版本已经准备好, 请重新启动',\n                success: (res: any)=>{\n                    if (res.confirm) {\n                        updateManager.applyUpdate();\n                    }\n                }\n            })\n        })\n    }\n\n    start () {\n        // @ts-ignore\n        if (window.cocosAnalytics) {\n            // @ts-ignore\n            window.cocosAnalytics.init({\n                appID: \"697959573\",              // 游戏ID\n                version: constants.VERSION,           // 游戏/应用版本号\n                storeID: \"wechat\",     // 分发渠道\n                engine: \"cocos\",            // 游戏引擎\n            });\n        }\n\n        // Your initialization goes here.\n\n        this.shareGame(\"更多精彩游戏等你来发现！\", \"https://res.592you.com/game-shares/cake/imgs/40.jpg\");\n\n        if (!profiler._stats) {\n            console.log('showStats');\n            profiler.showStats();\n        }\n\n        //@ts-ignore\n        // if (profiler._rootNode) {\n        //     //@ts-ignore\n        //     profiler._rootNode.active = false;\n        // }\n        \n        this.lbVersion.string = 'Version: ' + constants.VERSION;\n\n        this.updateSwitch();\n\n        if (this.manager) {\n            this.manager.onPeopleNumChanged = this.onPeopleNumberChanged.bind(this);\n        }\n    }\n\n    updateSwitch () {\n        this.spShadow.spriteFrame = this.enableShadow ? this.imgOn : this.imgOff;\n\n        this.spInstacing.spriteFrame = this.enableInstancing ? this.imgOn : this.imgOff;\n\n        this.spAliasing.spriteFrame = this.manager.enableAntiAliasing ? this.imgOn : this.imgOff;\n    }\n\n    onBtnAddClick () {\n        this.manager.addPlayerGroup();\n    }\n\n    onBtnResetClick () {\n        this.manager.resetPlayer();\n        this.curClickLogoTimes = 0;\n    }\n\n    onBtnReduceClick () {\n        //减人\n        this.manager.reducePlayer();\n    }\n\n    onLogoClick () {\n        this.curClickLogoTimes += 1;\n        if (this.curClickLogoTimes === this.maxClickLogoTimes) {\n            this.manager.addDancer();\n        }\n    }\n\n    switchInstancing () {\n        // this.spInstacing.spriteFrame\n\n        this.enableInstancing = !this.enableInstancing;\n    }\n\n    switchAliasing () {\n        //跳出提示框\n        let str = this.manager.enableAntiAliasing ? '关闭' : '开启';\n\n        this.nodeConfirmBox.getComponent(confirmBox)!.show(`${str}抗锯齿需要重启游戏`, ()=>{\n            this.manager.enableAntiAliasing = !this.manager.enableAntiAliasing;\n        }, ()=>{\n\n        });\n\n        this.nodeConfirmBox.active = true;\n    }\n\n    switchShadow () {\n        this.enableShadow = !this.enableShadow;\n    }\n\n    onNumberInputEnd() {\n        const num = Number.parseInt(this.numberInput.string);\n        this.manager.updatePlayerNumber(num);\n    }\n\n    onNumberClick (evt: EventTouch, data: string) {\n        const num = Number.parseInt(data);\n        this.manager.updatePlayerNumber(num);\n    }\n\n    onPeopleNumberChanged(num: number) {\n        if (this.numberInput) {\n            this.numberInput.string = num.toString();\n        }\n    }\n\n    update (deltaTime: number) {\n        // Your update function goes here.\n        this.count++;\n        if (this.count > 10 && profiler._stats) {\n            this.count = 0;\n\n            //fps\n            this.lbFps.string = Math.round(profiler._stats.fps.counter.value).toString();\n            \n            //drawcall\n            this.lbDrawcall.string = profiler._stats.draws.counter.value.toString();\n            this.lbInstancing.string = profiler._stats.instances.counter.value.toString();\n            this.lbTriangle.string = profiler._stats.tricount.counter.value.toString();\n            this.lbGFXMem.string = profiler._stats.textureMemory.counter.value.toFixed(1).toString();\n            this.lbGameLogic.string = profiler._stats.logic.counter.value.toFixed(2).toString();\n            this.lbArtTriangle.string = this.manager.artTriangle.toString();\n            this.lbVertex.string = this.manager.artVertex.toString();\n            this.lbPeople.string = this.manager.people.toString();\n        }\n\n        \n        \n        //\n    }\n\n    onDestroy() {\n        // @ts-ignore\n        if (profiler._rootNode) {\n            // @ts-ignore\n            profiler._rootNode.active = true;\n        }\n    }\n}\n"]}