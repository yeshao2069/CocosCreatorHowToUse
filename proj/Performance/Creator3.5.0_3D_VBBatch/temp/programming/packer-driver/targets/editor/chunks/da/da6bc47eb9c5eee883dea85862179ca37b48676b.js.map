{"version":3,"sources":["file:///Users/mu/work/gitee/cocos-creator-how-to-use/proj/Performance/Creator3.5.0_3D_VBBatch/assets/script/fight/playerManager.ts"],"names":["_decorator","Component","instantiate","Camera","Tween","Vec3","profiler","sys","player","ResManager","StorageManager","gameLogic","constants","ccclass","property","CAMERA_MOVE_PER_PERSON","ANTI_KEY","ARRNAME_KEY","playerManager","arrModel","arrName","vbbArrName","allArrName","artTriangle","artVertex","_people","onPeopleNumChanged","currentLevel","tweenCamera","isEnableVBB","_prevPeopleRate","isEnableShadow","isEnableAntiAliasing","isEnableLowModel","people","value","enableVBB","node","children","forEach","nodePlayer","playerScript","getComponent","changeVBBatch","enableShadow","changeShadow","enableAntiAliasing","instance","setGlobalData","isBrowser","window","location","reload","platform","WECHAT_GAME","console","log","wx","exitMiniProgram","complete","isNative","__restartVM","enableLowModel","onLoad","resPath","start","getGlobalData","name","getModel","err","prefab","push","length","addPlayerGroup","posCameraOrigin","mainCamera","position","clone","updatePlayerNumber","resetPlayer","destroyAllChildren","reducePlayer","num","addNum","i","pfModel","model","parent","show","triangle","vertex","Math","floor","moveUpCamera","rate","obj","round","_stats","fps","counter","toString","draws","instances","tricount","textureMemory","toFixed","logic","scheduleOnce","customEventStatistics","EVENT_TYPE","PERFORMANCE_PARAMETER","deleteNum","destroy","pos","forward","negative","multiplyScalar","add","stop","to","direction","addDancer","setScale","setPosition"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, instantiate, Camera, Tween, Vec3, easing, game, CCString, profiler, SkinningModelComponent, sys } from 'cc';\nimport { player } from './player';\nimport { SubPackageManager } from '../framework/util/subPackageManager';\nimport ResManager from '../framework/util/resManager';\nimport { StorageManager } from '../framework/config/storageManager';\nimport { gameLogic } from '../framework/util/gameLogic';\nimport { constants } from '../framework/util/constants';\nconst { ccclass, property } = _decorator;\n\nconst CAMERA_MOVE_PER_PERSON = 100; //每多少人摄像机抬高一次\n\nconst ANTI_KEY = 'anti-aliasing';\nconst ARRNAME_KEY = 'arrName';\n\n@ccclass('playerManager')\nexport class playerManager extends Component {\n    arrModel: Prefab[] = [];\n    arrName: string[] = [];\n    vbbArrName: string[] = []; // 可以参与 VB 合批的模型数组\n    allArrName: string[] = [];\n\n    @property(Camera)\n    mainCamera: Camera = null!;\n\n    //美术的面数及顶点数\n    artTriangle: number = 0;\n    artVertex: number = 0;\n    private _people: number = 0;\n    get people() {\n        return this._people;\n    }\n    set people(value: number) {\n        this._people = value;\n        if (this.onPeopleNumChanged) {\n            this.onPeopleNumChanged(this._people);\n        }\n    }\n\n    public onPeopleNumChanged: Function = null!;\n\n    currentLevel: number = 0;\n    tweenCamera: Tween;\n    posCameraOrigin !: Vec3;\n\n    isEnableVBB = false;\n\n    private _prevPeopleRate: number = 0; //人数除以30等于多少倍\n\n    set enableVBB (value: boolean) {\n        this.isEnableVBB = value;\n\n        this.node.children.forEach((nodePlayer)=>{\n            let playerScript = nodePlayer.getComponent(player);\n            if (playerScript) {\n                playerScript.changeVBBatch(value);\n            }\n        })\n    }\n\n    get enableVBB () {\n        return this.isEnableVBB;\n    }\n\n    isEnableShadow = true;\n\n    set enableShadow (value: boolean) {\n        this.isEnableShadow = value;\n\n        this.node.children.forEach((nodePlayer)=>{\n            let playerScript = nodePlayer.getComponent(player);\n            if (playerScript) {\n                playerScript.changeShadow(value);\n            }\n        })\n    }\n\n    get enableShadow () {\n        return this.isEnableShadow;\n    }\n\n    isEnableAntiAliasing = false;\n\n    set enableAntiAliasing (value: boolean) {\n        this.isEnableAntiAliasing = value;\n\n        StorageManager.instance.setGlobalData(ANTI_KEY, value);\n\n        if (sys.isBrowser) {\n            window.location.reload();\n        } else if (sys.platform === sys.WECHAT_GAME) {\n            console.log('reload!');\n            // @ts-ignore\n            window.wx.exitMiniProgram({\n                complete: ()=>{\n                    \n                }\n            });\n        } else if (sys.isNative) {\n            // @ts-ignore\n            window.__restartVM();\n        }\n    }\n\n    get enableAntiAliasing () {\n        return this.isEnableAntiAliasing;\n    }\n\n    isEnableLowModel = false;\n\n    set enableLowModel (value: boolean) {\n        this.isEnableLowModel = value;\n    }\n\n    get enableLowModel () {\n        return this.isEnableLowModel;\n    }\n\n    onLoad () {\n        ResManager.resPath = 'model-animation/';\n        StorageManager.instance.start();\n\n        this.isEnableAntiAliasing = StorageManager.instance.getGlobalData(ANTI_KEY) || false;\n    }\n\n    start () {\n        this.arrName = StorageManager.instance.getGlobalData(ARRNAME_KEY) || [\"altman\", \"clown\", \"cocosWalk\", \"kulou\", \"shitouWalk\", \"soldier\"];\n        this.arrName.forEach((name)=>{\n            ResManager.getModel(name, (err: any, prefab: Prefab)=>{\n                if (!err) {\n                    this.arrModel.push(prefab);\n\n                    if (this.arrModel.length === this.arrName.length) {\n                        this.addPlayerGroup();\n                    }\n                }\n            });\n        });\n\n        this.posCameraOrigin = this.mainCamera.node.position.clone();\n    }\n\n    addPlayerGroup () {\n        this.updatePlayerNumber(this.people + this.arrModel.length);\n    }\n\n    resetPlayer () {\n        this.node.destroyAllChildren();\n\n        this.artTriangle = 0;\n        this.artVertex = 0;\n        this.people = 0;\n        this.currentLevel = 0;\n\n        this.mainCamera.node.position = this.posCameraOrigin;\n\n        this._prevPeopleRate = 0;\n    }\n\n    reducePlayer () {\n        this.updatePlayerNumber(this.people - this.arrName.length);\n    }\n\n    updatePlayerNumber(num: number) {\n        if (this.people === num) {\n            return;\n        }\n\n        if (num < 0) {\n            num = 0;\n        }\n\n        // add\n        if (num > this.people) {\n            const addNum = num - this.people;\n            for (let i = 0; i < addNum; i++) {\n                const pfModel = this.arrModel[i % this.arrModel.length];\n                let model = instantiate(pfModel) as Node;\n                model.parent = this.node;\n                let playerScript = model.getComponent(player)!;\n                playerScript.show(this);\n    \n                this.artTriangle += playerScript.triangle;\n                this.artVertex += playerScript.vertex;\n            }\n\n            this.people = num;\n\n            if (Math.floor(this.people / CAMERA_MOVE_PER_PERSON) > this.currentLevel) {\n                //触发镜头拉高\n                this.moveUpCamera();\n            }\n    \n            let rate = Math.floor(this.people / 30);\n    \n            if (rate > this._prevPeopleRate) {\n                let obj = {\n                    'Fps': Math.round(profiler._stats!.fps.counter.value).toString(),     \n                    'Drawcall' : profiler._stats!.draws.counter.value.toString(),\n                    'Instancing' : profiler._stats!.instances.counter.value.toString(),\n                    'Triangle' : profiler._stats!.tricount.counter.value.toString(),\n                    'GFXMem' : profiler._stats!.textureMemory.counter.value.toFixed(1).toString(),\n                    'GameLogic' : profiler._stats!.logic.counter.value.toFixed(2).toString(),\n                    'ArtTriangle' : this.artTriangle.toString(),\n                    'Vertex' : this.artVertex.toString(),\n                    'People' : this.people.toString(),            \n                }\n                \n                this.scheduleOnce(()=>{\n                    gameLogic.customEventStatistics(constants.EVENT_TYPE.PERFORMANCE_PARAMETER, obj);\n                }, 0.5);\n    \n                this._prevPeopleRate = rate;\n            }\n        } else {    // reduce\n            const deleteNum = this.people - num;\n            for(let i = 0; i < deleteNum; i++) {\n                const nodePlayer = this.node.children[this.node.children.length - 1 - i];\n     \n                if (!nodePlayer) {\n                    return;\n                }\n    \n                let playerScript = nodePlayer.getComponent(player)!;\n                this.artTriangle -= playerScript.triangle;\n                this.artVertex -= playerScript.vertex;\n    \n                nodePlayer.destroy();\n            }\n\n            this.people = num;\n            \n            if (this.currentLevel > Math.floor(this.people / CAMERA_MOVE_PER_PERSON)) {\n                this.currentLevel = Math.floor(this.people / CAMERA_MOVE_PER_PERSON);\n\n                let pos = this.mainCamera.node.forward.clone().negative().multiplyScalar(8 * this.currentLevel);\n\n                pos.add(this.posCameraOrigin);\n\n                if (this.tweenCamera) {\n                    this.tweenCamera.stop();\n                    this.tweenCamera = null;\n                }\n        \n                this.tweenCamera = new Tween(this.mainCamera.node).to(0.2, {position: pos}).start();\n            }\n        }\n    }\n\n    moveUpCamera () {\n        this.currentLevel++;\n\n        let direction = this.mainCamera.node.forward.clone().negative().multiplyScalar(8);\n        direction.add(this.mainCamera.node.position);\n        \n\n        if (this.tweenCamera) {\n            this.tweenCamera.stop();\n            this.tweenCamera = null;\n        }\n\n        this.tweenCamera = new Tween(this.mainCamera.node).to(0.2, {position: direction}).start();\n    }\n\n    addDancer () {\n        ResManager.getModel('dance1', (err: any, prefab: any)=>{\n            if (!err) {\n                let model = instantiate(prefab) as Node;\n                model.parent = this.node;\n                model.setScale(new Vec3(2.5, 2.5, 2.5));\n                model.setPosition(new Vec3(2.4,0,2));\n            }\n        });\n    }\n\n    // enableVBB (isEnable: boolean) {\n    //     // this.arrName.forEach((name)=>{\n    //     //     let nodePlayer = this.node.getChildByName(name);\n\n    //     //     nodePlayer.getComponent(player).changeInstancingBatch(isEnable);\n    //     // });\n    //     this.isEnableVBB = false;\n\n    //     this.node.children.forEach((nodePlayer)=>{\n    //         let playerScript = nodePlayer.getComponent(player);\n    //         if (playerScript) {\n    //             playerScript.changeInstancingBatch(isEnable);\n    //         }\n    //     })\n    // }\n}\n"]}