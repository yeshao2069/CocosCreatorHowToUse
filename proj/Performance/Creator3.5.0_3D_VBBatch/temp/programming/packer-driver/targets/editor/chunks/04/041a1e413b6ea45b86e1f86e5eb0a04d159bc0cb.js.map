{"version":3,"sources":["file:///Users/mu/work/gitee/cocos-creator-how-to-use/proj/Performance/Creator3.5.0_3D_VBBatch/assets/script/fight/player.ts"],"names":["_decorator","Component","Vec3","Tween","SkeletalAnimation","SkinnedMeshRenderer","vbMaterial","ccclass","property","player","tweenMove","start","show","manager","x","currentLevel","Math","random","z","pos","node","position","move","enableVBB","changeVBBatch","changeShadow","enableShadow","onDestroy","stop","nextPoint","offset","clone","subtract","forward","normalize","negative","costTime","length","to","call","isEnable","arrVBB","getComponentsInChildren","forEach","vb","getComponent","play","arrModel","model","shadowCastingMode","ShadowCastingMode","ON","OFF"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,K,OAAAA,K;AAA+CC,MAAAA,iB,OAAAA,iB;AAAmBC,MAAAA,mB,OAAAA,mB;;AAErGC,MAAAA,U,iBAAAA,U;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;wBAGjBS,M,WADZF,OAAO,CAAC,QAAD,C,2BAAR,MACaE,MADb,SAC4BR,SAD5B,CACsC;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eASlCS,SATkC;AAAA;;AAWlCC,QAAAA,KAAK,GAAI,CACL;AACH;;AAEDC,QAAAA,IAAI,CAAEC,OAAF,EAA0B;AAC1B;AACA;AACA,eAAKA,OAAL,GAAeA,OAAf;AAEA,cAAIC,CAAC,GAAI,CAAC,CAAD,GAAK,IAAI,KAAKD,OAAL,CAAaE,YAAvB,GAAuCC,IAAI,CAACC,MAAL,MAAiB,KAAK,IAAI,KAAKJ,OAAL,CAAaE,YAAvC,CAA/C;AACA,cAAIG,CAAC,GAAG,CAAC,EAAD,GAAMF,IAAI,CAACC,MAAL,MAAiB,KAAK,IAAE,KAAKJ,OAAL,CAAaE,YAArC,CAAd;AAEA,cAAII,GAAG,GAAG,IAAIjB,IAAJ,CAASY,CAAT,EAAY,CAAZ,EAAeI,CAAf,CAAV;AAEA,eAAKE,IAAL,CAAUC,QAAV,GAAqBF,GAArB,CAV0B,CAY1B;;AACA,eAAKG,IAAL;;AAEA,cAAI,KAAKT,OAAL,CAAaU,SAAjB,EAA4B;AACxB,iBAAKC,aAAL,CAAmB,IAAnB,EADwB,CACE;AAC7B;;AAED,eAAKC,YAAL,CAAkB,KAAKZ,OAAL,CAAaa,YAA/B;AACH;;AAEDC,QAAAA,SAAS,GAAI;AACT,cAAI,KAAKjB,SAAT,EAAoB;AAChB,iBAAKA,SAAL,CAAekB,IAAf;AACA,iBAAKlB,SAAL,GAAiB,IAAjB;AACH;AACJ;;AAEDY,QAAAA,IAAI,GAAI;AACJ,cAAIO,SAAS,GAAG,IAAI3B,IAAJ,CAAU,CAAC,CAAD,GAAK,IAAI,KAAKW,OAAL,CAAaE,YAAvB,GAAuCC,IAAI,CAACC,MAAL,MAAiB,KAAK,IAAI,KAAKJ,OAAL,CAAaE,YAAvC,CAAhD,EAAsG,CAAtG,EAAyG,CAAC,EAAD,GAAMC,IAAI,CAACC,MAAL,MAAiB,KAAK,IAAE,KAAKJ,OAAL,CAAaE,YAArC,CAA/G,CAAhB;AAEA,cAAIe,MAAM,GAAGD,SAAS,CAACE,KAAV,GAAkBC,QAAlB,CAA2B,KAAKZ,IAAL,CAAUC,QAArC,CAAb;AAEA,eAAKD,IAAL,CAAUa,OAAV,GAAoBH,MAAM,CAACC,KAAP,GAAeG,SAAf,GAA2BC,QAA3B,EAApB;AAEA,cAAIC,QAAQ,GAAGN,MAAM,CAACO,MAAP,KAAkB,CAAjC;;AAEA,cAAI,KAAK3B,SAAT,EAAoB;AAChB,iBAAKA,SAAL,CAAekB,IAAf;AACA,iBAAKlB,SAAL,GAAiB,IAAjB;AACH;;AAED,eAAKA,SAAL,GAAiB,IAAIP,KAAJ,CAAU,KAAKiB,IAAf,EAAqBkB,EAArB,CAAwBF,QAAxB,EAAkC;AAACf,YAAAA,QAAQ,EAAEQ;AAAX,WAAlC,EAAyDU,IAAzD,CAA8D,MAAI;AAC/E,iBAAKjB,IAAL;AACH,WAFgB,EAEdX,KAFc,EAAjB;AAGH;;AAEDa,QAAAA,aAAa,CAAEgB,QAAF,EAAqB;AAC9B,cAAIC,MAAM,GAAG,KAAKrB,IAAL,CAAUsB,uBAAV;AAAA;AAAA,uCAAb;AACAD,UAAAA,MAAM,CAACE,OAAP,CAAgBC,EAAD,IAAM;AACjBA,YAAAA,EAAE,CAACrB,SAAH,GAAeiB,QAAf;AACH,WAFD;;AAIA,cAAIA,QAAJ,EAAc;AACV,iBAAKpB,IAAL,CAAUyB,YAAV,CAAuBzC,iBAAvB,EAA2C0C,IAA3C;AACH;AACJ;;AAEDrB,QAAAA,YAAY,CAAEe,QAAF,EAAqB;AAC7B,cAAIO,QAAQ,GAAG,KAAK3B,IAAL,CAAUsB,uBAAV,CAAkCrC,mBAAlC,CAAf;AACA0C,UAAAA,QAAQ,CAACJ,OAAT,CAAkBK,KAAD,IAAS;AACtBA,YAAAA,KAAK,CAACC,iBAAN,GAA0BT,QAAQ,GAAGnC,mBAAmB,CAAC6C,iBAApB,CAAsCC,EAAzC,GAA8C9C,mBAAmB,CAAC6C,iBAApB,CAAsCE,GAAtH;AACH,WAFD;AAGH;;AA/EiC,O,2EAEjC5C,Q;;;;;iBACkB,C;;iFAElBA,Q;;;;;iBACgB,C","sourcesContent":["import { _decorator, Component, Node, Vec3, Tween, ModelComponent, SkinningModelComponent, SkeletalAnimation, SkinnedMeshRenderer } from 'cc';\nimport { playerManager } from './playerManager';\nimport { vbMaterial } from './vbMaterial';\nconst { ccclass, property } = _decorator;\n\n@ccclass('player')\nexport class player extends Component {\n\n    @property\n    triangle: number = 0;\n\n    @property\n    vertex: number = 0;\n\n    manager !: playerManager;\n    tweenMove: Tween;\n\n    start () {\n        // Your initialization goes here.\n    }\n\n    show (manager: playerManager) {\n        //x: -5~5\n        //z: -20~6\n        this.manager = manager;\n\n        let x = (-8 - 3 * this.manager.currentLevel) + Math.random() * (16 + 6 * this.manager.currentLevel);\n        let z = -20 + Math.random() * (26 + 5*this.manager.currentLevel);\n\n        let pos = new Vec3(x, 0, z);\n\n        this.node.position = pos;\n\n        //TODO 开始随机移动\n        this.move();\n\n        if (this.manager.enableVBB) {\n            this.changeVBBatch(true); //如果当前开启合批，则跟随开启\n        }\n\n        this.changeShadow(this.manager.enableShadow);\n    }\n\n    onDestroy () {\n        if (this.tweenMove) {\n            this.tweenMove.stop();\n            this.tweenMove = null;\n        }\n    }\n\n    move () {\n        let nextPoint = new Vec3((-8 - 3 * this.manager.currentLevel) + Math.random() * (16 + 6 * this.manager.currentLevel), 0, -20 + Math.random() * (26 + 5*this.manager.currentLevel));\n\n        let offset = nextPoint.clone().subtract(this.node.position);\n\n        this.node.forward = offset.clone().normalize().negative();\n\n        let costTime = offset.length() / 2;\n\n        if (this.tweenMove) {\n            this.tweenMove.stop();\n            this.tweenMove = null;\n        }\n\n        this.tweenMove = new Tween(this.node).to(costTime, {position: nextPoint}).call(()=>{\n            this.move();\n        }).start();\n    }\n\n    changeVBBatch (isEnable: boolean) {\n        let arrVBB = this.node.getComponentsInChildren(vbMaterial);\n        arrVBB.forEach((vb)=>{\n            vb.enableVBB = isEnable;\n        });\n\n        if (isEnable) {\n            this.node.getComponent(SkeletalAnimation)!.play();\n        }\n    }\n\n    changeShadow (isEnable: boolean) {\n        let arrModel = this.node.getComponentsInChildren(SkinnedMeshRenderer);\n        arrModel.forEach((model)=>{\n            model.shadowCastingMode = isEnable ? SkinnedMeshRenderer.ShadowCastingMode.ON : SkinnedMeshRenderer.ShadowCastingMode.OFF;\n        });\n    }\n}\n"]}