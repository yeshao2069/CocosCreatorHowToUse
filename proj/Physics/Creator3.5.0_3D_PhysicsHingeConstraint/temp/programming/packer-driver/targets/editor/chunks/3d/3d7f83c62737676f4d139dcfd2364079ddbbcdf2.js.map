{"version":3,"sources":["file:///Users/mu/work/gitee/cocos-creator-how-to-use/proj/Physics/Creator3.5.0_3D_PhysicsHingeConstraint/assets/script/EmitBullet.ts"],"names":["_decorator","Component","Node","systemEvent","SystemEventType","Camera","Vec3","SphereCollider","RigidBody","instantiate","MeshRenderer","Material","BoxCollider","Primitive","CapsuleCollider","CylinderCollider","ConeCollider","GFXBlendFactor","Color","PhysicsSystem","ccclass","property","requireComponent","EmitBullet","type","PrimitiveType","_mesh","_material","_container","_bullet","onLoad","setParent","node","scene","initialize","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","setProperty","primitiveMesh","onLoaded","modelCom","addComponent","mesh","material","setWorldScale","BOX","SPHERE","CAPSULE","PHYSICS_CANNON","s1","center","s2","CYLINDER","CONE","console","error","onEnable","on","TOUCH_START","onTouchStart","onDisable","off","touch","event","cameraCom","getComponent","sp","getLocation","pos","x","y","target","screenToWorld","dir","subtract","worldPosition","normalize","multiplyScalar","strength","bullet","setWorldPosition","applyForce"],"mappings":";;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,W,OAAAA,W;AAClCC,MAAAA,e,OAAAA,e;AAAoCC,MAAAA,M,OAAAA,M;AACpCC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,c,OAAAA,c;AAAgBC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,W,OAAAA,W;AACjCC,MAAAA,Y,OAAAA,Y;AAAcC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,S,OAAAA,S;AACrCC,MAAAA,e,OAAAA,e;AAAiBC,MAAAA,gB,OAAAA,gB;AAAkBC,MAAAA,Y,OAAAA,Y;AACnCC,MAAAA,c,OAAAA,c;AAAkCC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,a,OAAAA,a;;;;;;;OACvC;AAAEC,QAAAA,OAAF;AAAWC,QAAAA,QAAX;AAAqBC,QAAAA;AAArB,O,GAA0CtB,U;;4BAInCuB,U,WAFZH,OAAO,CAAC,YAAD,C,UACPE,gBAAgB,CAACjB,MAAD,C,UAGZgB,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAEX,SAAS,CAACY;AAAlB,OAAD,C,0CAJb,MAEaF,UAFb,SAEgCtB,SAFhC,CAE0C;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAQ9ByB,KAR8B,GAQX,IARW;AAAA,eAS9BC,SAT8B,GASR,IATQ;AAAA,eAU9BC,UAV8B,GAUX,IAVW;AAAA,eAW9BC,OAX8B,GAWd,IAXc;AAAA;;AAatCC,QAAAA,MAAM,GAAI;AACN,eAAKF,UAAL,GAAkB,IAAI1B,IAAJ,CAAS,iBAAT,CAAlB;;AACA,eAAK0B,UAAL,CAAgBG,SAAhB,CAA0B,KAAKC,IAAL,CAAUC,KAApC;;AAEA,eAAKN,SAAL,GAAiB,IAAIhB,QAAJ,EAAjB;;AACA,eAAKgB,SAAL,CAAeO,UAAf,CAA0B;AACtB,0BAAc,kBADQ;AAEtB;AACA,sBAAU;AACN,4BAAc;AACV,2BAAW,CACP;AACI,2BAAS,IADb;AAGI;AACA;AACA;AAEA,8BAAYjB,cAAc,CAACkB,SAP/B;AAQI,8BAAYlB,cAAc,CAACmB,mBAR/B;AASI,mCAAiBnB,cAAc,CAACkB,SATpC;AAUI,mCAAiBlB,cAAc,CAACmB,mBAVpC,CAWI;;AAXJ,iBADO;AADD;AADR;AAHY,WAA1B;;AAuBA,eAAKT,SAAL,CAAeU,WAAf,CAA2B,WAA3B,EAAwC,IAAInB,KAAJ,CAAU,GAAV,EAAe,GAAf,EAAoB,GAApB,EAAyB,GAAzB,CAAxC;;AAEA,eAAKQ,KAAL,GAAa,IAAIb,SAAJ,CAAc,KAAKyB,aAAnB,CAAb;;AACA,eAAKZ,KAAL,CAAWa,QAAX;;AAEA,eAAKV,OAAL,GAAe,IAAI3B,IAAJ,CAAS,QAAT,CAAf;;AACA,gBAAMsC,QAAQ,GAAG,KAAKX,OAAL,CAAaY,YAAb,CAA0B/B,YAA1B,CAAjB;;AACA8B,UAAAA,QAAQ,CAACE,IAAT,GAAgB,KAAKhB,KAArB;AACAc,UAAAA,QAAQ,CAACG,QAAT,GAAoB,KAAKhB,SAAzB;;AAEA,eAAKE,OAAL,CAAae,aAAb,CAA2B,IAA3B,EAAiC,IAAjC,EAAuC,IAAvC;;AACA,eAAKf,OAAL,CAAaY,YAAb,CAA0BjC,SAA1B;;AACA,kBAAQ,KAAK8B,aAAb;AACI,iBAAKzB,SAAS,CAACY,aAAV,CAAwBoB,GAA7B;AACI,mBAAKhB,OAAL,CAAaY,YAAb,CAA0B7B,WAA1B;;AACA;;AACJ,iBAAKC,SAAS,CAACY,aAAV,CAAwBqB,MAA7B;AACI,mBAAKjB,OAAL,CAAaY,YAAb,CAA0BlC,cAA1B;;AACA;;AACJ,iBAAKM,SAAS,CAACY,aAAV,CAAwBsB,OAA7B;AACI,kBAAI5B,aAAa,CAAC6B,cAAlB,EAAkC;AAC9B,qBAAKnB,OAAL,CAAaY,YAAb,CAA0B1B,gBAA1B;;AACA,sBAAMkC,EAAE,GAAG,KAAKpB,OAAL,CAAaY,YAAb,CAA0BlC,cAA1B,CAAX;;AACA0C,gBAAAA,EAAE,CAACC,MAAH,GAAY,IAAI5C,IAAJ,CAAS,CAAT,EAAY,GAAZ,EAAiB,CAAjB,CAAZ;;AACA,sBAAM6C,EAAE,GAAG,KAAKtB,OAAL,CAAaY,YAAb,CAA0BlC,cAA1B,CAAX;;AACA4C,gBAAAA,EAAE,CAACD,MAAH,GAAY,IAAI5C,IAAJ,CAAS,CAAT,EAAY,CAAC,GAAb,EAAkB,CAAlB,CAAZ;AACH,eAND,MAMO;AACH,qBAAKuB,OAAL,CAAaY,YAAb,CAA0B3B,eAA1B;AACH;;AACD;;AACJ,iBAAKD,SAAS,CAACY,aAAV,CAAwB2B,QAA7B;AACI,mBAAKvB,OAAL,CAAaY,YAAb,CAA0B1B,gBAA1B;;AACA;;AACJ,iBAAKF,SAAS,CAACY,aAAV,CAAwB4B,IAA7B;AACI,mBAAKxB,OAAL,CAAaY,YAAb,CAA0BzB,YAA1B;;AACA;;AACJ;AACIsC,cAAAA,OAAO,CAACC,KAAR,CAAc,4BAAd,EAA4C1C,SAAS,CAACY,aAAV,CAAwB,KAAKa,aAA7B,CAA5C;AACA;AA1BR;AA4BH;;AAEDkB,QAAAA,QAAQ,GAAI;AACRrD,UAAAA,WAAW,CAACsD,EAAZ,CAAerD,eAAe,CAACsD,WAA/B,EAA4C,KAAKC,YAAjD,EAA+D,IAA/D;AACH;;AAEDC,QAAAA,SAAS,GAAI;AACTzD,UAAAA,WAAW,CAAC0D,GAAZ,CAAgBzD,eAAe,CAACsD,WAAhC,EAA6C,KAAKC,YAAlD,EAAgE,IAAhE;AACH;;AAEDA,QAAAA,YAAY,CAAEG,KAAF,EAAgBC,KAAhB,EAAmC;AAC3C,gBAAMC,SAAS,GAAG,KAAKC,YAAL,CAAkB5D,MAAlB,CAAlB;AACA,gBAAM6D,EAAE,GAAGJ,KAAK,CAACK,WAAN,EAAX;AACA,gBAAMC,GAAG,GAAG,IAAI9D,IAAJ,CAAS4D,EAAE,CAACG,CAAZ,EAAeH,EAAE,CAACI,CAAlB,EAAqB,CAArB,CAAZ;AAEA,gBAAMC,MAAM,GAAGP,SAAS,CAACQ,aAAV,CAAwBJ,GAAxB,CAAf;AACA,gBAAMK,GAAG,GAAGnE,IAAI,CAACoE,QAAL,CAAc,IAAIpE,IAAJ,EAAd,EAA0BiE,MAA1B,EAAkC,KAAKvC,IAAL,CAAU2C,aAA5C,EAA2DC,SAA3D,EAAZ;AACAH,UAAAA,GAAG,CAACI,cAAJ,CAAmB,KAAKC,QAAxB;AACA,gBAAMC,MAAM,GAAGtE,WAAW,CAAC,KAAKoB,OAAN,CAA1B;AACAkD,UAAAA,MAAM,CAAChD,SAAP,CAAiB,KAAKH,UAAtB;AACAmD,UAAAA,MAAM,CAACC,gBAAP,CAAwB,KAAKhD,IAAL,CAAU2C,aAAlC;AACAI,UAAAA,MAAM,CAACd,YAAP,CAAoBzD,SAApB,EAAgCyE,UAAhC,CAA2CR,GAA3C;AACH;;AAvGqC,O;;;;;iBAGtB5D,SAAS,CAACY,aAAV,CAAwBoB,G;;mFAEvCxB,Q;;;;;iBACU,K","sourcesContent":["import { _decorator, Component, Node, systemEvent, \n    SystemEventType, Touch, EventTouch, Camera, \n    Vec3, SphereCollider, RigidBody, instantiate, \n    MeshRenderer, Material, BoxCollider, Primitive, \n    CapsuleCollider, CylinderCollider, ConeCollider, \n    GFXBlendFactor, GFXBlendOp, Vec4, Color, PhysicsSystem } from 'cc';\nconst { ccclass, property, requireComponent } = _decorator;\n\n@ccclass('EmitBullet')\n@requireComponent(Camera)\nexport class EmitBullet extends Component {\n\n    @property({ type: Primitive.PrimitiveType })\n    primitiveMesh = Primitive.PrimitiveType.BOX;\n\n    @property\n    strength = 10000;\n\n    private _mesh: Primitive = null!;\n    private _material: Material = null!;\n    private _container: Node = null!;\n    private _bullet: Node = null!;\n\n    onLoad () {\n        this._container = new Node('__EMIT_BULLET__');\n        this._container.setParent(this.node.scene as any);\n\n        this._material = new Material();\n        this._material.initialize({\n            'effectName': 'builtin-standard',\n            // 'technique': 1, // Only pre-generated resources can be used\n            'states': {\n                'blendState': {\n                    'targets': [\n                        {\n                            'blend': true,\n\n                            // 'blendSrc': GFXBlendFactor.SRC_COLOR,\n                            // 'blendDst': GFXBlendFactor.DST_COLOR,\n                            // // 'blendEq': GFXBlendOp.ADD,\n\n                            'blendSrc': GFXBlendFactor.SRC_ALPHA,\n                            'blendDst': GFXBlendFactor.ONE_MINUS_SRC_ALPHA,\n                            'blendSrcAlpha': GFXBlendFactor.SRC_ALPHA,\n                            'blendDstAlpha': GFXBlendFactor.ONE_MINUS_SRC_ALPHA,\n                            // 'blendAlphaEq': GFXBlendOp.ADD,\n                        }\n                    ]\n                }\n            }\n        })\n        this._material.setProperty('mainColor', new Color(255, 255, 255, 128));\n\n        this._mesh = new Primitive(this.primitiveMesh);\n        this._mesh.onLoaded();\n\n        this._bullet = new Node('bullet');\n        const modelCom = this._bullet.addComponent(MeshRenderer);\n        modelCom.mesh = this._mesh;\n        modelCom.material = this._material;\n\n        this._bullet.setWorldScale(0.25, 0.25, 0.25);\n        this._bullet.addComponent(RigidBody);\n        switch (this.primitiveMesh) {\n            case Primitive.PrimitiveType.BOX:\n                this._bullet.addComponent(BoxCollider);\n                break;\n            case Primitive.PrimitiveType.SPHERE:\n                this._bullet.addComponent(SphereCollider);\n                break;\n            case Primitive.PrimitiveType.CAPSULE:\n                if (PhysicsSystem.PHYSICS_CANNON) {\n                    this._bullet.addComponent(CylinderCollider);\n                    const s1 = this._bullet.addComponent(SphereCollider);\n                    s1.center = new Vec3(0, 0.5, 0);\n                    const s2 = this._bullet.addComponent(SphereCollider);\n                    s2.center = new Vec3(0, -0.5, 0);\n                } else {\n                    this._bullet.addComponent(CapsuleCollider);\n                }\n                break;\n            case Primitive.PrimitiveType.CYLINDER:\n                this._bullet.addComponent(CylinderCollider);\n                break;\n            case Primitive.PrimitiveType.CONE:\n                this._bullet.addComponent(ConeCollider);\n                break;\n            default:\n                console.error(\"Unsupported collider type:\", Primitive.PrimitiveType[this.primitiveMesh]);\n                break;\n        }\n    }\n\n    onEnable () {\n        systemEvent.on(SystemEventType.TOUCH_START, this.onTouchStart, this);\n    }\n\n    onDisable () {\n        systemEvent.off(SystemEventType.TOUCH_START, this.onTouchStart, this);\n    }\n\n    onTouchStart (touch: Touch, event: EventTouch) {\n        const cameraCom = this.getComponent(Camera)!;\n        const sp = touch.getLocation();\n        const pos = new Vec3(sp.x, sp.y, 1);\n\n        const target = cameraCom.screenToWorld(pos);\n        const dir = Vec3.subtract(new Vec3(), target, this.node.worldPosition).normalize();\n        dir.multiplyScalar(this.strength);\n        const bullet = instantiate(this._bullet) as Node;\n        bullet.setParent(this._container);\n        bullet.setWorldPosition(this.node.worldPosition);\n        bullet.getComponent(RigidBody)!.applyForce(dir);\n    }\n\n}\n"]}