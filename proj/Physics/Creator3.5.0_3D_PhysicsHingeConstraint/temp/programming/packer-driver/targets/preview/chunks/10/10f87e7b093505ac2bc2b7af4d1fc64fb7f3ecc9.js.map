{"version":3,"sources":["file:///Users/mu/work/gitee/cocos-creator-how-to-use/proj/Physics/Creator3.5.0_3D_PhysicsHingeConstraint/assets/script/EmitBullet.ts"],"names":["_decorator","Component","Node","systemEvent","SystemEventType","Camera","Vec3","SphereCollider","RigidBody","instantiate","MeshRenderer","Material","BoxCollider","Primitive","CapsuleCollider","CylinderCollider","ConeCollider","Color","PhysicsSystem","gfx","ccclass","property","requireComponent","EmitBullet","type","PrimitiveType","_mesh","_material","_container","_bullet","onLoad","setParent","node","scene","reset","BlendFactor","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","setProperty","primitiveMesh","onLoaded","modelCom","addComponent","mesh","material","setWorldScale","BOX","SPHERE","CAPSULE","PHYSICS_CANNON","s1","center","s2","CYLINDER","CONE","console","error","onEnable","on","TOUCH_START","onTouchStart","onDisable","off","touch","event","cameraCom","getComponent","sp","getLocation","pos","x","y","target","screenToWorld","dir","subtract","worldPosition","normalize","multiplyScalar","strength","bullet","setWorldPosition","applyForce"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, systemEvent, SystemEventType, Touch, EventTouch, Camera, \n    Vec3, SphereCollider, RigidBody, instantiate,  MeshRenderer, Material, BoxCollider, Primitive, \n    CapsuleCollider, CylinderCollider, ConeCollider, Vec4, Color, PhysicsSystem, gfx } from 'cc';\nconst { ccclass, property, requireComponent } = _decorator;\n\n@ccclass('EmitBullet')\n@requireComponent(Camera)\nexport class EmitBullet extends Component {\n\n    @property({ type: Primitive.PrimitiveType })\n    primitiveMesh = Primitive.PrimitiveType.BOX;\n\n    @property\n    strength = 10000;\n\n    private _mesh: Primitive = null!;\n    private _material: Material = null!;\n    private _container: Node = null!;\n    private _bullet: Node = null!;\n\n    onLoad () {\n        this._container = new Node('__EMIT_BULLET__');\n        this._container.setParent(this.node.scene as any);\n\n        this._material = new Material();\n        this._material.reset({\n            'effectName': 'builtin-standard',\n            // 'technique': 1, // Only pre-generated resources can be used\n            'states': {\n                'blendState': {\n                    'targets': [\n                        {\n                            'blend': true,\n\n                            // 'blendSrc': GFXBlendFactor.SRC_COLOR,\n                            // 'blendDst': GFXBlendFactor.DST_COLOR,\n                            // // 'blendEq': GFXBlendOp.ADD,\n\n                            'blendSrc': gfx.BlendFactor.SRC_ALPHA,\n                            'blendDst': gfx.BlendFactor.ONE_MINUS_SRC_ALPHA,\n                            'blendSrcAlpha': gfx.BlendFactor.SRC_ALPHA,\n                            'blendDstAlpha': gfx.BlendFactor.ONE_MINUS_SRC_ALPHA,\n                            // 'blendAlphaEq': GFXBlendOp.ADD,\n                        }\n                    ]\n                }\n            }\n        })\n        this._material.setProperty('mainColor', new Color(255, 255, 255, 128));\n\n        this._mesh = new Primitive(this.primitiveMesh);\n        this._mesh.onLoaded();\n\n        this._bullet = new Node('bullet');\n        const modelCom = this._bullet.addComponent(MeshRenderer);\n        modelCom.mesh = this._mesh;\n        modelCom.material = this._material;\n\n        this._bullet.setWorldScale(0.25, 0.25, 0.25);\n        this._bullet.addComponent(RigidBody);\n        switch (this.primitiveMesh) {\n            case Primitive.PrimitiveType.BOX:\n                this._bullet.addComponent(BoxCollider);\n                break;\n            case Primitive.PrimitiveType.SPHERE:\n                this._bullet.addComponent(SphereCollider);\n                break;\n            case Primitive.PrimitiveType.CAPSULE:\n                if (PhysicsSystem.PHYSICS_CANNON) {\n                    this._bullet.addComponent(CylinderCollider);\n                    const s1 = this._bullet.addComponent(SphereCollider);\n                    s1.center = new Vec3(0, 0.5, 0);\n                    const s2 = this._bullet.addComponent(SphereCollider);\n                    s2.center = new Vec3(0, -0.5, 0);\n                } else {\n                    this._bullet.addComponent(CapsuleCollider);\n                }\n                break;\n            case Primitive.PrimitiveType.CYLINDER:\n                this._bullet.addComponent(CylinderCollider);\n                break;\n            case Primitive.PrimitiveType.CONE:\n                this._bullet.addComponent(ConeCollider);\n                break;\n            default:\n                console.error(\"Unsupported collider type:\", Primitive.PrimitiveType[this.primitiveMesh]);\n                break;\n        }\n    }\n\n    onEnable () {\n        systemEvent.on(SystemEventType.TOUCH_START, this.onTouchStart, this);\n    }\n\n    onDisable () {\n        systemEvent.off(SystemEventType.TOUCH_START, this.onTouchStart, this);\n    }\n\n    onTouchStart (touch: Touch, event: EventTouch) {\n        const cameraCom = this.getComponent(Camera)!;\n        const sp = touch.getLocation();\n        const pos = new Vec3(sp.x, sp.y, 1);\n\n        const target = cameraCom.screenToWorld(pos);\n        const dir = Vec3.subtract(new Vec3(), target, this.node.worldPosition).normalize();\n        dir.multiplyScalar(this.strength);\n        const bullet = instantiate(this._bullet) as Node;\n        bullet.setParent(this._container);\n        bullet.setWorldPosition(this.node.worldPosition);\n        bullet.getComponent(RigidBody)!.applyForce(dir);\n    }\n\n}\n"]}