{"version":3,"sources":["file:///Users/mu/work/gitee/cocos-creator-how-to-use/proj/Demo/Creator3.5.0_BezierCurvePathCreator/assets/scripts/NodeEvents.ts"],"names":["NodeEvents","find","game","_decorator","Node","EventMouse","UITransform","UIOpacity","Vec3","BezierCurveType","Ident","ccclass","property","isMouseDown","isOperate","convertToNodeSpace","evt","pos","getUILocation","tempPos","x","y","getComponent","convertToNodeSpaceAR","isDelete","node","ident","point","atDrawingArea","resolution","window","getResolution","halfW","width","halfH","height","isDragMove","mousePos","target","flag","control","console","log","name","setMoveTargetNode","moveTargetNode","setOperateStatus","bol","addDragEvents","on","EventType","MOUSE_DOWN","event","propagationStopped","getButton","BUTTON_LEFT","MOUSE_MOVE","opacity","canvas","style","cursor","setPosition","MOUSE_LEAVE","MOUSE_UP","saveBezierPath","addPointDeleteEvents","BUTTON_RIGHT","setDeleteTarget","emit","addCanvasTouchEvents","canvasNode","getBezierCurveType","SecondOrder","createCurve","ThirdOrder","createThirdOrderCurve"],"mappings":"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","sourcesContent":["import { find, game, _decorator, Node, EventMouse, UITransform, UIOpacity, Vec3 } from 'cc';\nimport { BezierCurveType, Ident } from './Enums';\nconst { ccclass, property } = _decorator;\n\nccclass('NodeEvents')\nexport class NodeEvents {\n    //移动目标节点\n    moveTargetNode !: Node;\n    isMouseDown = false;\n    isOperate = true;\n\n    // 屏幕坐标转换到节点坐标\n    convertToNodeSpace (evt: any) {\n        let pos = evt.getUILocation();\n        let tempPos = new Vec3(pos.x, pos.y, 0);\n        return find(\"Canvas\")!.getComponent(UITransform)!.convertToNodeSpaceAR(tempPos);\n    }\n\n    // 是否能删除\n    isDelete (node: any) {\n        return node.ident == Ident.point;\n    }\n\n    // 是否在绘制区域\n    atDrawingArea(pos: Vec3) {\n        let resolution = window['BezierData'].getResolution();\n        let halfW = resolution.width / 2;\n        let halfH = resolution.height / 2;\n\n        return pos.x > -halfW && pos.x < halfW &&\n            pos.y > -halfH && pos.y < halfH;\n    }\n\n    // 是否能拖拽\n    isDragMove (mousePos: Vec3, target: any) {\n        let flag = false;\n        switch (target.ident) {\n            case Ident.point:\n            case Ident.control:\n                flag = this.atDrawingArea(mousePos)\n                break;\n            case Ident.window:\n                flag = true;\n\n        }\n        console.log(target.name, target.ident);\n\n        return flag;\n    }\n\n    setMoveTargetNode (target: any) {\n        this.moveTargetNode = target;\n    }\n    \n    setOperateStatus (bol: boolean) {\n        this.isOperate = bol;\n    }\n\n    // 添加拖拽事件\n    addDragEvents (node: Node, target = node) {\n        // 鼠标按下\n        node.on(Node.EventType.MOUSE_DOWN, (event: any) => {\n            event.propagationStopped = true;\n            // 鼠标右键\n            if (event.getButton() == EventMouse.BUTTON_LEFT /**&& _this.isOperate()**/) {\n                this.moveTargetNode = target;\n                this.isMouseDown = true;\n            }\n        });\n        // 鼠标移动\n        node.on(Node.EventType.MOUSE_MOVE, (evt: any) => {\n            target.getComponent(UIOpacity)!.opacity = 100;\n            game.canvas!.style.cursor = \"all-scroll\";\n            //鼠标按下并且有指定目标节点\n            if (this.isMouseDown && this.moveTargetNode) {\n                //把屏幕坐标转换到节点坐标下\n                let mousePos = this.convertToNodeSpace(evt);\n                if (this.isDragMove(mousePos, this.moveTargetNode)){\n                    this.moveTargetNode!.setPosition(mousePos);\n                }\n            }\n        });\n\n        // 鼠标离开\n        node.on(Node.EventType.MOUSE_LEAVE, (evt: any) => {\n            target.getComponent(UIOpacity)!.opacity = 255;\n            game.canvas!.style.cursor = \"auto\";\n        });\n\n        // 鼠标抬起\n        node.on(Node.EventType.MOUSE_UP, (evt: any) => {\n            this.isMouseDown = false;\n            this.moveTargetNode = null!;\n            window['BezierData'].saveBezierPath();//保存坐标点\n        });\n    }\n\n    // 添加节点的删除事件\n    addPointDeleteEvents (node: Node) {\n        // 鼠标按下\n        node.on(Node.EventType.MOUSE_DOWN, (evt: any) => {\n            // 鼠标右键\n            if (evt.getButton() == EventMouse.BUTTON_RIGHT) {\n                if (this.isDelete(evt.target)) {\n                    let mousePos = this.convertToNodeSpace(evt);\n                    // this.deleteTarget = event.target;\n                    window['BezierData'].setDeleteTarget(evt.target);\n                    window['EventListener'].emit(\"showDeleteBtn\", mousePos);\n                }\n                return\n            }\n        });\n\n    }\n\n    // 添加Canvas节点事件\n    addCanvasTouchEvents (canvasNode = find(\"Canvas\")!) {\n        let target;\n        // 鼠标按下\n        canvasNode.on(Node.EventType.MOUSE_DOWN, (evt: any) => {\n\n            // 鼠标左键\n            if (evt.getButton() == EventMouse.BUTTON_LEFT) {\n                evt.propagationStopped = true;\n                target = evt.target;\n                //创建坐标点,需要先把屏幕坐标转换到节点坐标下\n                let mousePos = this.convertToNodeSpace(evt);\n                if (!this.atDrawingArea(mousePos))\n                    return ;\n                if (!this.isOperate){\n                    window['EventListener'].emit(\"hideDeleteBtn\", null);\n                } \n\n                // 二阶\n                if (window['BezierData'].getBezierCurveType() == BezierCurveType.SecondOrder) {\n                    window['BezierData'].createCurve(mousePos);\n                }\n                // 三阶\n                if (window['BezierData'].getBezierCurveType() == BezierCurveType.ThirdOrder) {\n                    window['BezierData'].createThirdOrderCurve(mousePos);\n                }\n                this.isMouseDown = true;\n            }\n        });\n        // 鼠标移动\n        canvasNode.on(Node.EventType.MOUSE_MOVE, (evt: any) => {\n            target = evt.target;\n            //创建坐标点,需要先把屏幕坐标转换到节点坐标下\n            let mousePos = this.convertToNodeSpace(evt);\n            window['EventListener'].emit(\"setMouseLocation\", mousePos);\n\n            //鼠标按下并且有指定目标节点\n            if (this.isMouseDown && this.moveTargetNode && this.isDragMove(mousePos, this.moveTargetNode)) {\n                console.log(\"moveTargetNode.setPosition(mousePos);\");\n                this.moveTargetNode.setPosition(mousePos);\n            }\n        });\n        // 鼠标抬起\n        canvasNode.on(Node.EventType.MOUSE_UP, (evt: any) => {\n            target = evt.target;\n            this.isMouseDown = false;\n            this.moveTargetNode = null!;\n        });\n    }\n\n}\n"]}