{"version":3,"sources":["file:///Users/mu/work/gitee/cocos-creator-how-to-use/proj/Spine/Creator3.5.0_2D_SpineBoy/assets/script/SpineBoyCtrl.ts"],"names":["_decorator","Component","ccclass","property","SpineBoyCtrl","mixTime","_hasStop","onLoad","spine","getComponent","_setMix","setStartListener","trackEntry","animationName","animation","name","console","log","trackIndex","setInterruptListener","setEndListener","setDisposeListener","setCompleteListener","clearTrack","loopCount","Math","floor","trackTime","animationEnd","setEventListener","event","data","intValue","floatValue","stringValue","toggleDebugSlots","debugSlots","toggleDebugBones","debugBones","toggleDebugMesh","debugMesh","toggleUseTint","useTint","toggleTimeScale","timeScale","stop","walk","setAnimation","run","jump","oldAnim","addAnimation","shoot","idle","portal","anim1","anim2","setMix"],"mappings":"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","sourcesContent":["import { _decorator, Component, sp } from \"cc\";\nconst { ccclass, property } = _decorator;\n\n@ccclass('SpineBoyCtrl')\nexport default class SpineBoyCtrl extends Component{\n\n    mixTime:number= 0.2;\n\n    private spine !: sp.Skeleton;\n    private _hasStop = true;\n\n    onLoad () {\n        var spine = this.spine = this.getComponent('sp.Skeleton') as sp.Skeleton;\n        this._setMix('walk', 'run');\n        this._setMix('run', 'jump');\n        this._setMix('walk', 'jump');\n\n        spine.setStartListener(trackEntry => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            console.log(\"[track %s][animation %s] start.\", trackEntry.trackIndex, animationName);\n        });\n        spine.setInterruptListener(trackEntry => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            console.log(\"[track %s][animation %s] interrupt.\", trackEntry.trackIndex, animationName);\n        });\n        spine.setEndListener(trackEntry => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            console.log(\"[track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\n        });\n        spine.setDisposeListener(trackEntry => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            console.log(\"[track %s][animation %s] will be disposed.\", trackEntry.trackIndex, animationName);\n        });\n        spine.setCompleteListener((trackEntry) => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            if (animationName === 'shoot') {\n                this.spine!.clearTrack(1);\n            }\n            var loopCount = Math.floor(trackEntry.trackTime / trackEntry.animationEnd);\n            console.log(\"[track %s][animation %s] complete: %s\", trackEntry.trackIndex, animationName, loopCount);\n        });\n        spine.setEventListener(((trackEntry:any, event:any) => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            console.log(\"[track %s][animation %s] event: %s, %s, %s, %s\", trackEntry.trackIndex, animationName, event.data.name, event.intValue, event.floatValue, event.stringValue);\n        }) as any);\n\n        this._hasStop = false;\n    }\n\n    // OPTIONS\n\n    toggleDebugSlots () {\n        this.spine.debugSlots = !this.spine.debugSlots;\n    }\n\n    toggleDebugBones () {\n        this.spine.debugBones = !this.spine.debugBones;\n    }\n\n    toggleDebugMesh () {\n        this.spine.debugMesh = !this.spine.debugMesh;\n    }\n\n    toggleUseTint () {\n        this.spine.useTint = !this.spine.useTint;\n    }\n\n    toggleTimeScale () {\n        if (this.spine.timeScale === 1.0) {\n            this.spine.timeScale = 0.3;\n        }\n        else {\n            this.spine.timeScale = 1.0;\n        }\n    }\n\n    // ANIMATIONS\n\n    stop () {\n        this.spine.clearTrack(0);\n        this._hasStop = true;\n    }\n\n    walk () {\n        this.spine.setAnimation(0, 'walk', true);\n        this._hasStop = false;\n    }\n\n    run () {\n        this.spine.setAnimation(0, 'run', true);\n        this._hasStop = false;\n    }\n\n    jump () {\n        var oldAnim = this.spine?.animation;\n        this.spine.setAnimation(0, 'jump', false);\n        if (oldAnim && !this._hasStop) {\n            this.spine?.addAnimation(0, oldAnim === 'run' ? 'run' : 'walk', true, 0);\n        }\n    }\n\n    shoot () {\n        this.spine.setAnimation(1, 'shoot', false);\n    }\n\n    idle () {\n        this.spine.setAnimation(0, 'idle', true);\n    }\n\n    portal () {\n        this.spine.setAnimation(0, 'portal', false);\n    }\n\n    //\n\n    _setMix (anim1: string, anim2: string) {\n        this.spine.setMix(anim1, anim2, this.mixTime);\n        this.spine.setMix(anim2, anim1, this.mixTime);\n    }\n}\n"]}