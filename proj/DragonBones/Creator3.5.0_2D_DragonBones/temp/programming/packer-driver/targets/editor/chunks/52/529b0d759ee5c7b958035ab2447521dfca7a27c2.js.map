{"version":3,"sources":["file:///Users/mu/work/gitee/cocos-creator-how-to-use/proj/DragonBones/Creator3.5.0_2D_DragonBones/assets/script/DragonBonesCtrl.ts"],"names":["_decorator","Component","Node","dragonBones","macro","SystemEventType","systemEvent","Vec3","director","ccclass","property","requireComponent","NORMAL_ANIMATION_GROUP","AIM_ANIMATION_GROUP","ATTACK_ANIMATION_GROUP","JUMP_SPEED","NORMALIZE_MOVE_SPEED","MAX_MOVE_SPEED_FRONT","MAX_MOVE_SPEED_BACK","WEAPON_R_LIST","WEAPON_L_LIST","SKINS","GROUND","G","DragonBonesCtrl","ArmatureDisplay","type","_bullets","_left","_right","_isJumpingA","_isJumpingB","_isSquating","_isAttackingA","_isAttackingB","_weaponRIndex","_weaponLIndex","_skinIndex","_faceDir","_aimDir","_moveDir","_aimRadian","_speedX","_speedY","_armature","_weaponR","_weaponL","_aimState","_walkState","_attackState","_target","_mouseDown_","onLoad","_armatureDisplay","getComponent","armature","addEventListener","EventObject","FADE_IN_COMPLETE","_animationEventHandler","FADE_OUT_COMPLETE","COMPLETE","getSlot","childArmature","FRAME_EVENT","_frameEventHandler","i","length","skinArmature","armatureName","weaponArmature","_updateAnimation","touchHandler","on","TOUCH_START","event","touchLoc","getUILocation","aim","x","y","attack","TOUCH_END","TOUCH_MOVE","upButton","jump","downButton","squat","TOUCH_CANCEL","leftButton","_updateMove","rightButton","KEY_DOWN","_keyHandler","keyCode","KEY_UP","isDown","KEY","a","left","d","right","w","up","s","down","q","switchWeaponR","e","switchWeaponL","space","dir","move","animation","fadeIn","isSquating","isAttacking","removeEventListener","newWeaponName","factory","CCFactory","getInstance","buildArmature","switchSkin","skinName","skinData","getArmatureData","defaultSkin","replaceSkin","t","node","parent","_uiProps","uiTransformComp","convertToNodeSpaceAR","update","dt","_updatePosition","_updateAim","_updateAttack","_enterFrameHandler","onDisable","bullet","enabled","addBullet","push","splice","animationState","name","resetToPose","bone","localPoint","global","display","globalPoint","convertToWorldSpace","_fire","firePoint","Math","random","z","effect","radian","PI","DragonBullet","init","timeScale","camera","root","ui","getFirstRenderCamera","pos","getPosition","minX","width","maxX","setPosition","scale","getScale","setScale","aimOffsetY","getBone","atan2","aimDir","weight","abs","invalidUpdate","AnimationFadeOutMode","SameGroup","autoFadeOutTime","fadeTotalTime","_effect","parentNode","speed","position","cos","sin","thePos","playAnimation","armatureNode","angle","DEG","effectDisplay","scaleX","scaleY","addChild","uiTrans","worldPos","convertToWorldSpaceAR","height","doClean","removeFromParent"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, dragonBones, macro, SystemEventType, systemEvent, Vec3, director, EventTouch } from 'cc';\nconst { ccclass, property, requireComponent } = _decorator;\n\n\nvar NORMAL_ANIMATION_GROUP = \"normal\";\nvar AIM_ANIMATION_GROUP = \"aim\";\nvar ATTACK_ANIMATION_GROUP = \"attack\";\nvar JUMP_SPEED = -20;\nvar NORMALIZE_MOVE_SPEED = 3.6;\nvar MAX_MOVE_SPEED_FRONT = NORMALIZE_MOVE_SPEED * 1.4;\nvar MAX_MOVE_SPEED_BACK = NORMALIZE_MOVE_SPEED * 1.0;\nvar WEAPON_R_LIST = [\"weapon_1502b_r\", \"weapon_1005\", \"weapon_1005b\", \"weapon_1005c\", \"weapon_1005d\", \"weapon_1005e\"];\nvar WEAPON_L_LIST = [\"weapon_1502b_l\", \"weapon_1005\", \"weapon_1005b\", \"weapon_1005c\", \"weapon_1005d\"];\nvar SKINS = [\"mecha_1502b\", \"skin_a\", \"skin_b\", \"skin_c\"];\nvar GROUND = -200;\nvar G = -0.6;\n\n\n@ccclass('DragonBonesCtrl')\n@requireComponent(dragonBones.ArmatureDisplay)\nexport default class DragonBonesCtrl extends Component {\n\n    @property({ type: Node })\n    touchHandler !: Node;\n    @property({ type: Node })\n    upButton !: Node;\n    @property({ type: Node })\n    downButton !: Node;\n    @property({ type: Node })\n    leftButton !: Node;\n    @property({ type: Node })\n    rightButton !: Node;\n    @property({ type: dragonBones.ArmatureDisplay })\n    weaponArmature  !: dragonBones.ArmatureDisplay;\n    @property({ type: dragonBones.ArmatureDisplay })\n    skinArmature  !: dragonBones.ArmatureDisplay;\n\n    _bullets:any[] = [];\n    _left = false;\n    _right = false;\n    _isJumpingA = false;\n    _isJumpingB = false;\n    _isSquating = false;\n    _isAttackingA = false;\n    _isAttackingB = false;\n    _weaponRIndex = 0;\n    _weaponLIndex = 0;\n    _skinIndex = 0;\n    _faceDir = 1;\n    _aimDir = 0;\n    _moveDir = 0;\n    _aimRadian = 0;\n    _speedX = 0;\n    _speedY = 0;\n    _armature: any= null;\n    _armatureDisplay !:dragonBones.ArmatureDisplay;\n    _weaponR:any = null;\n    _weaponL:any = null;\n    _aimState :any= null;\n    _walkState:any = null;\n    _attackState :any = null;\n    _target = new Vec3(0, 0, 0);\n    _mouseDown_ = false;\n\n    // use this for initialization\n    onLoad () {\n        this._armatureDisplay = this.getComponent(dragonBones.ArmatureDisplay)!;\n        this._armature = this._armatureDisplay.armature();\n\n        this._armatureDisplay.addEventListener((dragonBones as any).EventObject.FADE_IN_COMPLETE, this._animationEventHandler, this);\n        this._armatureDisplay.addEventListener((dragonBones as any).EventObject.FADE_OUT_COMPLETE, this._animationEventHandler, this);\n        this._armatureDisplay.addEventListener((dragonBones as any).EventObject.COMPLETE, this._animationEventHandler, this);\n\n        this._weaponR = this._armature.getSlot('weapon_r').childArmature;\n        this._weaponL = this._armature.getSlot('weapon_l').childArmature;\n        this._weaponR.addEventListener((dragonBones as any).EventObject.FRAME_EVENT, this._frameEventHandler, this);\n        this._weaponL.addEventListener((dragonBones as any).EventObject.FRAME_EVENT, this._frameEventHandler, this);\n\n        // load all skin data\n        for (let i = 1; i < SKINS.length; i++) {\n            this.skinArmature!.armatureName = SKINS[i];\n        }\n\n        for (let i = 1; i < WEAPON_R_LIST.length; i++) {\n            this.weaponArmature!.armatureName = WEAPON_R_LIST[i];\n        }\n\n        this._updateAnimation();\n\n        if (this.touchHandler) {\n            // touch event\n            this.touchHandler.on(SystemEventType.TOUCH_START, (event: EventTouch) => {\n                this._mouseDown_ = true;\n                var touchLoc = event.getUILocation();\n                this.aim(touchLoc.x, touchLoc.y);\n                this.attack(true);\n            } , this);\n            this.touchHandler.on(SystemEventType.TOUCH_END, (event: EventTouch) => {\n                this._mouseDown_ = false;\n                this.attack(false);\n            }, this);\n            this.touchHandler.on(SystemEventType.TOUCH_MOVE, (event: EventTouch) => {\n                var touchLoc = event.getUILocation();\n                this.aim(touchLoc.x, touchLoc.y);\n            }, this);\n        }\n\n        if (this.upButton) {\n            this.upButton.on(SystemEventType.TOUCH_START, (event: any) => {\n                this.jump();\n            }, this);\n        }\n\n        if (this.downButton) {\n            this.downButton.on(SystemEventType.TOUCH_START, (event: any) => {\n                this.squat(true);\n            } ,this);\n            this.downButton.on(SystemEventType.TOUCH_END, (event: any) => {\n                this.squat(false);\n            } ,this);\n            this.downButton.on(SystemEventType.TOUCH_CANCEL, (event: any) => {\n                this.squat(false);\n            } ,this);\n        }\n\n        if (this.leftButton) {\n            this.leftButton.on(SystemEventType.TOUCH_START, (event: any) => {\n                this._left = true;\n                this._updateMove(-1);\n            } ,this);\n            this.leftButton.on(SystemEventType.TOUCH_END, (event: any) => {\n                this._left = false;\n                this._updateMove(-1);\n            } ,this);\n            this.leftButton.on(SystemEventType.TOUCH_CANCEL, (event: any) => {\n                this._left = false;\n                this._updateMove(-1);\n            } ,this);\n        }\n\n        if (this.rightButton) {\n            this.rightButton.on(SystemEventType.TOUCH_START, (event: any) => {\n                this._right = true;\n                this._updateMove(1);\n            } ,this);\n            this.rightButton.on(SystemEventType.TOUCH_END, (event: any) => {\n                this._right = false;\n                this._updateMove(1);\n            }, this);\n            this.rightButton.on(SystemEventType.TOUCH_CANCEL, (event: any) => {\n                this._right = false;\n                this._updateMove(1);\n            } ,this);\n        }\n\n        // keyboard events\n        systemEvent.on(SystemEventType.KEY_DOWN,  (event) => {\n            this._keyHandler(event!.keyCode, true);\n        }, this);\n        systemEvent.on(SystemEventType.KEY_UP,  (event) => {\n            this._keyHandler(event!.keyCode, false);\n        },this);\n    }\n\n    _keyHandler (keyCode: number, isDown: boolean) {\n        switch (keyCode) {\n            case macro.KEY.a:\n            case macro.KEY.left:\n                this._left = isDown;\n                this._updateMove(-1);\n                break;\n            case macro.KEY.d:\n            case macro.KEY.right:\n                this._right = isDown;\n                this._updateMove(1);\n                break;\n            case macro.KEY.w:\n            case macro.KEY.up:\n                if (isDown) {\n                    this.jump();\n                }\n                break;\n            case macro.KEY.s:\n            case macro.KEY.down:\n                this.squat(isDown);\n                break;\n            case macro.KEY.q:\n                if (isDown) {\n                    this.switchWeaponR();\n                }\n                break;\n            case macro.KEY.e:\n                if (isDown) {\n                    this.switchWeaponL();\n                }\n                break;\n            case macro.KEY.space:\n                if (isDown) {\n                    this.switchWeaponR();\n                    this.switchWeaponL();\n                }\n                break;\n            default:\n                return;\n        }\n    }\n\n    _updateMove (dir: number) {\n        if (this._left && this._right) {\n            this.move(dir);\n        } else if (this._left) {\n            this.move(-1);\n        } else if (this._right) {\n            this.move(1);\n        } else {\n            this.move(0);\n        }\n    }\n\n    move (dir: number) {\n        if (this._moveDir === dir) {\n            return;\n        }\n\n        this._moveDir = dir;\n        this._updateAnimation();\n    }\n\n    jump () {\n        if (this._isJumpingA) {\n            return;\n        }\n\n        this._isJumpingA = true;\n        this._armature.animation.fadeIn(\"jump_1\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n        this._walkState = null;\n    }\n\n    squat (isSquating: boolean) {\n        if (this._isSquating === isSquating) {\n            return;\n        }\n\n        this._isSquating = isSquating;\n        this._updateAnimation();\n    }\n\n    attack (isAttacking: boolean) {\n        if (this._isAttackingA == isAttacking) {\n            return;\n        }\n\n        this._isAttackingA = isAttacking;\n    }\n\n    switchWeaponL () {\n        this._weaponL.removeEventListener((dragonBones as any).EventObject.FRAME_EVENT, this._frameEventHandler, this);\n\n        this._weaponLIndex++;\n        if (this._weaponLIndex >= WEAPON_L_LIST.length) {\n            this._weaponLIndex = 0;\n        }\n\n        var newWeaponName = WEAPON_L_LIST[this._weaponLIndex];\n        let factory = (dragonBones as any).CCFactory.getInstance();\n        this._weaponL = factory.buildArmature(newWeaponName);\n        this._armature.getSlot('weapon_l').childArmature = this._weaponL;\n\n        this._weaponL.addEventListener((dragonBones as any).EventObject.FRAME_EVENT, this._frameEventHandler, this);\n    }\n\n    switchWeaponR () {\n        this._weaponR.removeEventListener((dragonBones as any).EventObject.FRAME_EVENT, this._frameEventHandler, this);\n\n        this._weaponRIndex++;\n        if (this._weaponRIndex >= WEAPON_R_LIST.length) {\n            this._weaponRIndex = 0;\n        }\n\n        var newWeaponName = WEAPON_R_LIST[this._weaponRIndex];\n        let factory = dragonBones.CCFactory.getInstance() as any;\n        this._weaponR = factory.buildArmature(newWeaponName);\n        this._armature.getSlot('weapon_r').childArmature = this._weaponR;\n\n        this._weaponR.addEventListener((dragonBones as any).EventObject.FRAME_EVENT, this._frameEventHandler, this);\n    }\n\n    switchSkin () {\n        this._skinIndex++;\n        if (this._skinIndex >= SKINS.length) {\n            this._skinIndex = 0;\n        }\n        let skinName = SKINS[this._skinIndex];\n        let factory = dragonBones.CCFactory.getInstance()  as any;\n        let skinData = factory.getArmatureData(skinName).defaultSkin;\n        factory.replaceSkin(this._armatureDisplay!.armature(), skinData, false, [\"weapon_l\", \"weapon_r\"]);\n    }\n\n    aim (x: any, y: any) {\n        if (this._aimDir === 0) {\n            this._aimDir = 10;\n        }\n\n        const t = this._target = this.node.parent!._uiProps.uiTransformComp!.convertToNodeSpaceAR(new Vec3(x, y, 0));\n    }\n\n    update (dt: any) {\n        this._updatePosition();\n        this._updateAim();\n        this._updateAttack();\n        this._enterFrameHandler(dt);\n    }\n\n    onDisable () {\n        // clean the bullets\n        for (var i = this._bullets.length - 1; i >= 0; i--) {\n            var bullet = this._bullets[i];\n            bullet.enabled = false;\n        }\n        this._bullets = [];\n    }\n\n    addBullet (bullet: any) {\n        this._bullets.push(bullet);\n    }\n\n    _enterFrameHandler (dt: any) {\n        for (var i = this._bullets.length - 1; i >= 0; i--) {\n            var bullet = this._bullets[i];\n            if (bullet.update()) {\n                this._bullets.splice(i, 1);\n            }\n        }\n    }\n\n    _animationEventHandler (event: { type: any; animationState: { name: string; }; }) {\n        if (event.type === (dragonBones as any).EventObject.FADE_IN_COMPLETE) {\n            if (event.animationState.name === \"jump_1\") {\n                this._isJumpingB = true;\n                this._speedY = -JUMP_SPEED;\n\n                if (this._moveDir != 0) {\n                    if (this._moveDir * this._faceDir > 0) {\n                        this._speedX = MAX_MOVE_SPEED_FRONT * this._faceDir;\n                    }\n                    else {\n                        this._speedX = -MAX_MOVE_SPEED_BACK * this._faceDir;\n                    }\n                }\n\n                this._armature.animation.fadeIn(\"jump_2\", -1, -1, 0, NORMAL_ANIMATION_GROUP).resetToPose = false;\n            } else if (event.animationState.name === \"jump_4\") {\n                this._updateAnimation();\n            }\n        }\n        else if (event.type === (dragonBones as any).EventObject.FADE_OUT_COMPLETE) {\n            if (event.animationState.name === \"attack_01\") {\n                this._isAttackingB = false;\n                this._attackState = null;\n            }\n        }\n        else if (event.type === (dragonBones as any).EventObject.COMPLETE) {\n            if (event.animationState.name === \"jump_4\") {\n                this._isJumpingA = false;\n                this._isJumpingB = false;\n                this._updateAnimation();\n            }\n        }\n    }\n\n    _frameEventHandler (event: any, bone: any, armature: any ) {\n        if (event.name === \"fire\") {\n            // var firePointBone = event.armature.getBone(\"firePoint\");\n            var localPoint = new Vec3(event.bone.global.x, event.bone.global.y, 0);\n\n            var display = event.armature.display;\n            var globalPoint = display.node.convertToWorldSpace(localPoint);\n            this._fire(globalPoint);\n        }\n    }\n\n    _fire (firePoint: Vec3) {\n        firePoint.x += Math.random() * 2 - 1;\n        firePoint.y += Math.random() * 2 - 1;\n        firePoint.z = 0;\n\n        var armature = this._armatureDisplay!.buildArmature(\"bullet_01\");\n        var effect = this._armatureDisplay!.buildArmature(\"fire_effect_01\");\n        var radian = this._faceDir < 0 ? Math.PI - this._aimRadian : this._aimRadian;\n        var bullet = new DragonBullet();\n        bullet.init(this.node.parent!, armature, effect, radian + Math.random() * 0.02 - 0.01, 40, firePoint);\n        this.addBullet(bullet);\n    }\n\n    _updateAnimation () {\n        if (this._isJumpingA) {\n            return;\n        }\n\n        if (this._isSquating) {\n            this._speedX = 0;\n            this._armature.animation.fadeIn(\"squat\", -1, -1, 0, NORMAL_ANIMATION_GROUP).resetToPose = false;\n            this._walkState = null;\n            return;\n        }\n\n        if (this._moveDir === 0) {\n            this._speedX = 0;\n            this._armature.animation.fadeIn(\"idle\", -1, -1, 0, NORMAL_ANIMATION_GROUP).resetToPose = false;\n            this._walkState = null;\n        } else {\n            if (!this._walkState) {\n                this._walkState = this._armature.animation.fadeIn(\"walk\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n                this._walkState.resetToPose = false;\n            }\n\n            if (this._moveDir * this._faceDir > 0) {\n                this._walkState.timeScale = MAX_MOVE_SPEED_FRONT / NORMALIZE_MOVE_SPEED;\n            } else {\n                this._walkState.timeScale = -MAX_MOVE_SPEED_BACK / NORMALIZE_MOVE_SPEED;\n            }\n\n            if (this._moveDir * this._faceDir > 0) {\n                this._speedX = MAX_MOVE_SPEED_FRONT * this._faceDir;\n            } else {\n                this._speedX = -MAX_MOVE_SPEED_BACK * this._faceDir;\n            }\n        }\n    }\n\n    _updatePosition () {\n        const camera = (director.root! as any).ui.getFirstRenderCamera(this.node)!;\n        const pos = this.node.getPosition();\n        if (this._speedX !== 0) {\n            pos.x += this._speedX;\n            var minX = -camera.width / 2;\n            var maxX = camera.width / 2;\n            if (pos.x < minX) {\n                pos.x = minX;\n            } else if (pos.x > maxX) {\n                pos.x = maxX;\n            }\n            this.node.setPosition(pos);\n\n        }\n\n        if (this._speedY != 0) {\n            if (this._speedY > 5 && this._speedY + G <= 5) {\n                this._armature.animation.fadeIn(\"jump_3\", -1, -1, 0, NORMAL_ANIMATION_GROUP).resetToPose = false;\n            }\n\n            this._speedY += G;\n            pos.y += this._speedY;\n            if (pos.y < GROUND) {\n                pos.y = GROUND;\n                this._speedY = 0;\n                this._armature.animation.fadeIn(\"jump_4\", -1, -1, 0, NORMAL_ANIMATION_GROUP).resetToPose = false;\n            }\n            this.node.setPosition(pos);\n        }\n    }\n\n    _updateAim () {\n        if (!this._mouseDown_) return;\n\n        if (this._aimDir === 0) {\n            return;\n        }\n        const pos = this.node.getPosition();\n        const scale = this.node.getScale();\n\n        this._faceDir = this._target.x > pos.x ? 1 : -1;\n        if (scale.x * this._faceDir < 0) {\n            scale.x *= -1;\n            if (this._moveDir) {\n                this._updateAnimation();\n            }\n            this.node.setScale(scale);\n        }\n\n        var aimOffsetY = this._armature.getBone(\"chest\").global.y * scale.y;\n\n        if (this._faceDir > 0) {\n            this._aimRadian = Math.atan2(this._target.y - pos.y - aimOffsetY, this._target.x - pos.x);\n        } else {\n            this._aimRadian = Math.PI - Math.atan2(this._target.y - pos.y - aimOffsetY, this._target.x - pos.x);\n            if (this._aimRadian > Math.PI) {\n                this._aimRadian -= Math.PI * 2;\n            }\n        }\n\n        let aimDir = 0;\n        if (this._aimRadian > 0) {\n            aimDir = 1;\n        } else {\n            aimDir = -1;\n        }\n\n        if (this._aimDir != aimDir) {\n            this._aimDir = aimDir;\n\n            // Animation mixing.\n            if (this._aimDir >= 0) {\n                this._aimState = this._armature.animation.fadeIn(\n                    \"aim_up\", -1.0, -1,\n                    0, AIM_ANIMATION_GROUP);\n            } else {\n                this._aimState = this._armature.animation.fadeIn(\n                    \"aim_down\", -1.0, -1,\n                    0, AIM_ANIMATION_GROUP);\n            }\n\n            this._aimState.resetToPose = false;\n        }\n\n        this._aimState.weight = Math.abs(this._aimRadian / Math.PI * 2);\n\n        //_armature.invalidUpdate(\"pelvis\"); // Only update bone mask.\n        this._armature.invalidUpdate();\n    }\n\n    _updateAttack () {\n        if (!this._isAttackingA || this._isAttackingB) {\n            return;\n        }\n\n        this._isAttackingB = true;\n\n        // Animation mixing.\n        this._attackState = this._armature.animation.fadeIn(\n            \"attack_01\", -1.0, -1,\n            0, ATTACK_ANIMATION_GROUP, dragonBones.AnimationFadeOutMode.SameGroup\n        );\n\n        this._attackState.resetToPose = false;\n        this._attackState.autoFadeOutTime = this._attackState.fadeTotalTime;\n    }\n}\n\n\n@ccclass('DragonBullet')\nexport class DragonBullet {\n\n    _speedX= 0;\n    _speedY = 0;\n\n    _armature: any =  null;\n    _armatureDisplay: any =  null;\n    _effect: any = null;\n\n    init (parentNode: Node, armature: dragonBones.ArmatureDisplay, effect: any, radian: number, speed: number, position: Vec3) {\n        this._speedX = Math.cos(radian) * speed;\n        this._speedY = Math.sin(radian) * speed;\n        var thePos = parentNode._uiProps.uiTransformComp!.convertToNodeSpaceAR(position);\n\n        armature.playAnimation(\"idle\");\n\n        let armatureNode = armature.node;\n        armatureNode.setPosition(thePos);\n        armatureNode.angle = radian * macro.DEG;\n\n        this._armature = armature;\n\n        if (effect) {\n            this._effect = effect;\n            var effectDisplay = this._effect.node;\n            effectDisplay.angle = radian * macro.DEG;\n            effectDisplay.setPosition(thePos);\n            effectDisplay.scaleX = 1 + Math.random() * 1;\n            effectDisplay.scaleY = 1 + Math.random() * 0.5;\n            if (Math.random() < 0.5) {\n                effectDisplay.scaleY *= -1;\n            }\n\n            this._effect.playAnimation(\"idle\");\n\n            parentNode.addChild(effectDisplay);\n        }\n\n        parentNode.addChild(armatureNode);\n    }\n\n    update () {\n        let armatureNode = this._armature.node as Node;\n        const pos = armatureNode.getPosition();\n        pos.x += this._speedX;\n        pos.y += this._speedY;\n        armatureNode.setPosition(pos);\n        const uiTrans = armatureNode.parent!._uiProps.uiTransformComp!;\n        var worldPos = uiTrans.convertToWorldSpaceAR(armatureNode.getPosition());\n        const camera = (director.root! as any).ui.getFirstRenderCamera(armatureNode)!;\n        if (\n            worldPos.x < -100 || worldPos.x >= camera.width + 100 ||\n            worldPos.y < -100 || worldPos.y >= camera.height + 100\n        ) {\n            this.doClean();\n            return true;\n        }\n\n        return false;\n    }\n\n    onDisable () {\n        this.doClean();\n    }\n\n    doClean () {\n        this._armature.node.removeFromParent();\n\n        if (this._effect) {\n            this._effect.node.removeFromParent();\n        }\n    }\n}\n"]}